<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Spotify Analysis</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <style type="text/css"></style>
  </head>
  <body>
    <div id="load">Loading</div>
    <button>Remove All Bars</button>
    <script src="./data.js"></script>
    <script type="text/javascript">
      //Create scale functions
      const display = dataset => {
        const w = 1200;
        const h = 600;
        const padding = 90;
        // Normalise Data
        const xScale = d3
          .scaleBand()
          .domain(d3.range(dataset.length))
          .rangeRound([padding, w])
          .paddingInner(0.05);

        const yScale = d3
          .scaleLinear()
          .domain([0, d3.max(dataset, d => d.value.weekDiff)])
          .range([padding, h - padding]);

        // - QUESTION: why do I have to create a reverse yScale for the y - axis?
        const yAxisScale = d3
          .scaleLinear()
          .domain([d3.max(dataset, d => d.value.weekDiff) + 10, 0])
          .range([padding, h - padding]);

        // Define Axis
        var xAxis = d3
          .axisBottom()
          .scale(xScale)
          .tickFormat((d, i) => {
            console.log(dataset[d].value.country);
            return countryCode[dataset[d].value.country];
          });
        // Here i use a new scale that is reversed
        var yAxis = d3.axisLeft().scale(yAxisScale);

        const key = d => d.key;

        svg = d3
          .select('body')
          .append('svg')
          .attr('width', w)
          .attr('height', h);

        svg
          .selectAll('rect')
          .data(dataset, key)
          .enter()
          .append('rect')
          .attr('x', (d, i) => xScale(i))
          .attr('y', d => h - yScale(d.value.weekDiff) - padding)
          .attr('width', d => xScale.bandwidth())
          .attr('height', d => yScale(d.value.weekDiff))
          .attr('fill', d => `rgb(0, 0, ${d.value.weekDiff * 2})`);

        svg
          .append('g')
          .attr('class', 'x axis')
          .attr('transform', `translate(0, ${h - padding})`)
          .call(xAxis)
          .selectAll('text')
          .attr('y', 0)
          .attr('x', 9)
          .attr('dy', '.35em')
          .attr('transform', 'rotate(90)')
          .style('text-anchor', 'start');

        //Create Y axis
        svg
          .append('g')
          .attr('class', 'y axis')
          .attr('transform', `translate(${padding},0)`)
          .call(yAxis);

        d3.select('#load').text('Loaded');

        d3.select('button').on('click', () => {
          d3.selectAll();
        });
      };

      display(countriesUniqueSong);
    </script>
  </body>
</html>
